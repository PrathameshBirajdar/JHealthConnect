<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - JHealthConnect</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body th:classappend="${darkMode} ? 'dark-mode' : ''">

    <div class="layout">
        <div th:replace="fragments/sidebar :: sidebar"></div>
        <div class="main">
            <div th:replace="fragments/header :: header"></div>
            <div class="content">
                <h2>Admin Dashboard</h2>

                <section>
                    <h3>Doctors</h3>
                    <div class="table-container">
                        <table>
                            <tr>
                                <th>Name</th>
                                <th>Specialization</th>
                                <th>Experience</th>
                            </tr>
                            <tr th:each="doc : ${doctors}">
                                <td th:text="${doc.name}"></td>
                                <td th:text="${doc.specialization}"></td>
                                <td th:text="${doc.experience} + ' yrs'"></td>
                            </tr>
                        </table>
                    </div>
                </section>
                
                <section>
                    <h3>Insurance Companies</h3>
                    <div class="table-container">
                        <table>
                            <tr>
                                <th>Company</th>
                                <th>Policies</th>
                            </tr>
                            <tr th:each="ins : ${insurance}">
                                <td th:text="${ins.companyName}"></td>
                                <td th:text="${ins.policyCount}"></td>
                            </tr>
                        </table>
                    </div>
                </section>
                
            <section>
                <h3>Pending Appointments</h3>
            
                <!-- Filter Dropdown -->
                <form method="get" action="/admin/dashboard">
                    <label for="status">Filter by Status: </label>
                    <select name="status" id="status" onchange="this.form.submit()">
                        <option value="">All</option>
                        <option value="PENDING">Pending</option>
                        <option value="APPROVED">Approved</option>
                        <option value="REJECTED">Rejected</option>
                    </select>
                </form>
            
                <div class="table-container">
                    <table>
                        <tr>
                            <th>Patient</th>
                            <th>Doctor</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        <tr th:each="appt : ${appointments}">
                            <td th:text="${appt.patientName}"></td>
                            <td th:text="${appt.doctor.name}"></td>
                            <td th:text="${appt.date}"></td>
                            <td>
                                <span th:text="${appt.status}" th:classappend="' status-badge ' +
                                          (${appt.status} == 'APPROVED' ? 'status-approved' :
                                          (${appt.status} == 'REJECTED' ? 'status-rejected' : 'status-pending'))">
                                </span>
                            </td>
                            <td>
                                <form th:action="@{/admin/appointments/approve/{id}(id=${appt.id})}" method="post"
                                    style="display:inline;">
                                    <button type="submit" class="btn-approve">✅ Approve</button>
                                </form>
                                <form th:action="@{/admin/appointments/reject/{id}(id=${appt.id})}" method="post"
                                    style="display:inline;">
                                    <button type="submit" class="btn-reject">❌ Reject</button>
                                </form>
                            </td>
                        </tr>
                    </table>
                </div>
            </section>
            </div>
        </div>
    </div>
</body>

</html>